# 📋 交易日志文件说明

## 📁 文件位置

交易日志文件：`trade_log.csv`

**完整路径**: `ZCF_RL_STOCK/trade_log.csv`

## 📊 文件格式

### CSV 文件结构

| 列名 | 说明 | 示例 | 备注 |
|------|------|------|------|
| 时间戳 | 操作时间 | 2025-11-28 10:30:00 | 完整时间戳 |
| 日期 | 操作日期 | 2025-11-28 | YYYY-MM-DD |
| 时间 | 操作时间 | 10:30:00 | HH:MM:SS |
| 股票代码 | 股票代码 | sh.600036 | 格式：sh.XXXXXX 或 sz.XXXXXX |
| 操作类型 | 操作类型 | 买入/卖出/持有 | 三种类型 |
| 操作比例 | 操作比例 | 100%/50%/25% | 百分比 |
| **当前价格** | 当前市场价格 | 43.25 | 元 |
| **建议买入价格** | 建议买入价格 | 43.20 | 元（仅买入时） |
| **建议卖出价格** | 建议卖出价格 | 43.30 | 元（仅卖出时） |
| **预测数量** | 预测交易数量 | 500.00 | 股 |
| **预测金额** | 预测交易金额 | 21625.00 | 元 |
| 持仓数量 | 当前持仓数量 | 500.00 | 股 |
| 可用资金 | 当前可用资金 | 78375.00 | 元 |
| 总资产 | 总资产 | 100000.00 | 元 |
| 操作状态 | 操作状态 | 预测/待执行/已执行 | 三种状态 |
| 备注 | 备注信息 | 模型预测/仓位变动 | 说明信息 |

### 字段详解

#### 价格相关字段

1. **当前价格**: 模型预测时的市场价格
2. **建议买入价格**: 模型建议的买入价格（买入操作时）
3. **建议卖出价格**: 模型建议的卖出价格（卖出操作时）

**注意**: 
- 建议价格默认等于当前价格
- 可以根据策略调整建议价格（如设置价格区间）

#### 预测相关字段

1. **预测数量**: 根据操作比例计算的预测交易数量
2. **预测金额**: 根据操作比例计算的预测交易金额

**计算方式**:
- 买入: `预测金额 = 可用资金 × 操作比例`, `预测数量 = 预测金额 / 建议买入价格`
- 卖出: `预测数量 = 持仓数量 × 操作比例`, `预测金额 = 预测数量 × 建议卖出价格`

#### 操作状态

- **预测**: 模型预测的操作（尚未执行）
- **待执行**: 待执行的操作（已记录但未执行）
- **已执行**: 已执行的操作（仓位已变动）

## 📝 使用示例

### 示例 1: 买入操作记录

```csv
时间戳,日期,时间,股票代码,操作类型,操作比例,当前价格,建议买入价格,建议卖出价格,预测数量,预测金额,持仓数量,可用资金,总资产,操作状态,备注
2025-11-28 10:30:00,2025-11-28,10:30:00,sh.600036,买入,100%,43.25,43.25,,2326.01,100000.00,0.00,100000.00,100000.00,预测,模型预测
```

**解读**:
- 当前价格: 43.25 元
- 建议买入价格: 43.25 元
- 预测数量: 2326.01 股
- 预测金额: 100,000.00 元（100% 资金）
- 状态: 预测（尚未执行）

### 示例 2: 卖出操作记录

```csv
时间戳,日期,时间,股票代码,操作类型,操作比例,当前价格,建议买入价格,建议卖出价格,预测数量,预测金额,持仓数量,可用资金,总资产,操作状态,备注
2025-11-28 11:00:00,2025-11-28,11:00:00,sh.600036,卖出,50%,43.50,,43.50,1163.01,50611.04,2326.01,0.00,100000.00,已执行,仓位变动
```

**解读**:
- 当前价格: 43.50 元
- 建议卖出价格: 43.50 元
- 预测数量: 1163.01 股（50% 持仓）
- 预测金额: 50,611.04 元
- 状态: 已执行（仓位已变动）

## 🔍 如何查看日志

### 方法 1: 直接打开 CSV 文件

使用 Excel、WPS 或其他表格软件打开 `trade_log.csv`

### 方法 2: 使用 Python 查看

```python
import pandas as pd

# 读取日志
df = pd.read_csv('trade_log.csv', encoding='utf-8-sig')

# 查看所有记录
print(df)

# 查看买入操作
buy_ops = df[df['操作类型'] == '买入']
print(buy_ops)

# 查看已执行的操作
executed = df[df['操作状态'] == '已执行']
print(executed)
```

### 方法 3: 使用命令行查看

```bash
# Windows PowerShell
Get-Content trade_log.csv | Select-Object -First 20

# 或使用 Python
python -c "import pandas as pd; df=pd.read_csv('trade_log.csv', encoding='utf-8-sig'); print(df.tail(10))"
```

## 📊 数据分析

### 统计买入/卖出次数

```python
import pandas as pd

df = pd.read_csv('trade_log.csv', encoding='utf-8-sig')

# 统计操作类型
print(df['操作类型'].value_counts())

# 统计操作状态
print(df['操作状态'].value_counts())

# 计算总交易金额
buy_total = df[df['操作类型'] == '买入']['预测金额'].sum()
sell_total = df[df['操作类型'] == '卖出']['预测金额'].sum()
print(f"总买入金额: {buy_total:.2f} 元")
print(f"总卖出金额: {sell_total:.2f} 元")
```

### 分析价格趋势

```python
# 分析建议价格
buy_prices = df[df['操作类型'] == '买入']['建议买入价格']
sell_prices = df[df['操作类型'] == '卖出']['建议卖出价格']

print(f"平均买入价格: {buy_prices.mean():.2f} 元")
print(f"平均卖出价格: {sell_prices.mean():.2f} 元")
```

## 🔧 文件维护

### 备份日志

建议定期备份日志文件：

```bash
# 备份到带日期的文件
cp trade_log.csv trade_log_backup_2025-11-28.csv
```

### 清理旧记录

如果需要清理旧记录：

```python
import pandas as pd
from datetime import datetime, timedelta

# 读取日志
df = pd.read_csv('trade_log.csv', encoding='utf-8-sig')

# 只保留最近30天的记录
df['时间戳'] = pd.to_datetime(df['时间戳'])
cutoff_date = datetime.now() - timedelta(days=30)
df = df[df['时间戳'] >= cutoff_date]

# 保存
df.to_csv('trade_log.csv', index=False, encoding='utf-8-sig')
```

## ⚠️ 注意事项

1. **文件编码**: 使用 UTF-8 with BOM (utf-8-sig) 编码，确保 Excel 能正确显示中文
2. **文件位置**: 日志文件保存在脚本运行目录
3. **文件大小**: 长期运行可能产生大量记录，建议定期备份和清理
4. **数据准确性**: 请定期检查日志数据的准确性

## 📚 相关文档

- [实时预测](../docs/实时预测.md) - 实时预测系统使用
- [持仓管理](../docs/持仓管理.md) - 持仓状态管理
- [操作记录](../docs/操作记录.md) - 操作记录功能说明

---

**提示**: 日志文件是重要的交易记录，请妥善保管。

