# V6 组合管理与差异化策略版

## 🎯 版本定位

**V6 = V5风险感知 + 组合管理 + 差异化策略**

从单标的交易进化到**智能组合管理**！

---

## 🆕 V6 核心创新

### 1. **扩展标的池（17只）** 📊

| 类别 | 标的数量 | 代表 |
|------|---------|------|
| **科技** | 7只 | 恒生科技、半导体、AI创新、机器人等 |
| **金融** | 3只 | 浦发、招商、港股非银 |
| **消费/医药** | 2只 | 消费ETF、创新药 |
| **周期/新能源** | 3只 | 有色、新能源、孚日股份 |
| **宽基** | 2只 | 创蓝筹、科创50 |

### 2. **差异化风险策略** 🎯

```python
# 不再"一刀切"，根据标的特性定制策略

高波动标的（如半导体ETF）:
  - 风险阈值: 4分（更容忍波动）
  - 最大仓位: 80%
  - 回撤容忍: 25%
  - 策略: 激进

低波动标的（如银行股）:
  - 风险阈值: 2分（更谨慎）
  - 最大仓位: 100%
  - 回撤容忍: 15%
  - 策略: 稳健

中波动标的（如消费ETF）:
  - 风险阈值: 3分
  - 最大仓位: 90%
  - 回撤容忍: 20%
  - 策略: 平衡
```

### 3. **智能分类管理** 🧠

**标的元数据**：
```python
{
    'code': 'sh.513180',
    'name': '恒生科技',
    'category': '科技',      # 行业分类
    'volatility': '高',      # 波动性
    'style': '激进'          # 风格
}
```

**自动识别并调整**：
- 科技股 → 高风险策略
- 金融股 → 稳健策略
- ETF → 根据标的调整

### 4. **组合视角** 📈

```
不同标的用不同策略：
  - 科技ETF（60%资金）→ 激进策略，追求高收益
  - 金融股（30%资金）→ 稳健策略，控制风险
  - 消费ETF（10%资金）→ 平衡策略，稳定收益
```

---

## 📊 标的详细列表

### 科技板块（7只）⚡

| 代码 | 名称 | 波动性 | 特点 |
|------|------|--------|------|
| sh.513180 | 恒生科技 | 高 | 港股科技龙头 |
| sh.512480 | 半导体ETF | 高 | 周期性强 |
| sz.159770 | 机器人 | 高 | 新兴行业 |
| sh.588000 | 科创50 | 高 | 科创板代表 |
| sh.515070 | AI创新 | 高 | AI主题 |
| sh.588030 | 科创智能 | 高 | 智能制造 |
| sz.001389 | 广合科技 | 高 | 个股 |

### 金融板块（3只）🏦

| 代码 | 名称 | 波动性 | 特点 |
|------|------|--------|------|
| sh.600000 | 浦发银行 | 低 | 大型银行 |
| sh.600036 | 招商银行 | 低 | 优质银行 |
| sh.513090 | 港股非银 | 中 | 港股金融 |

### 消费/医药（2只）🛒

| 代码 | 名称 | 波动性 | 特点 |
|------|------|--------|------|
| sz.159928 | 消费ETF | 中 | 消费主题 |
| sz.159992 | 创新药 | 高 | 医药创新 |

### 周期/新能源（3只）⚙️

| 代码 | 名称 | 波动性 | 特点 |
|------|------|--------|------|
| sz.159876 | 有色基金 | 高 | 有色金属 |
| sh.516160 | 新能源 | 高 | 新能源车 |
| sz.002083 | 孚日股份 | 高 | 个股 |

### 宽基（2只）📊

| 代码 | 名称 | 波动性 | 特点 |
|------|------|--------|------|
| sz.159966 | 创蓝筹 | 中 | 蓝筹股 |
| sh.600418 | 江淮汽车 | 中 | 个股 |

---

## 🚀 使用流程

### 第一步：下载数据

```bash
python get_stock_data_v6.py
```

**说明**：
- 自动下载17只标的数据
- 生成元数据文件（metadata_v6.csv）
- 分训练集（≤2024）和测试集（>2024）

**预期时间**：5-10分钟

---

### 第二步：训练模型

```bash
python train_v6.py
```

**训练参数**：
- 总步数：250万步
- 并行环境：16个
- 预计时间：3-4小时

**训练过程中**：
- 自动识别每个标的的类别
- 应用差异化策略
- 保存检查点

---

### 第三步：查看结果

训练完成后自动显示：

```
[整体统计]
  平均收益率: +XX%
  平均最大回撤: XX%
  ...

[分类统计]
  [科技] (7只)
    平均收益率: +XX%
    ...
  [金融] (3只)
    平均收益率: +XX%
    ...
```

---

## 💡 差异化策略详解

### 策略配置表

| 波动性 | 风险阈值 | 最大仓位 | 回撤容忍 | 高风险持仓惩罚 |
|--------|---------|---------|---------|---------------|
| **高** | 4分 | 80% | 25% | -0.15 |
| **中** | 3分 | 90% | 20% | -0.20 |
| **低** | 2分 | 100% | 15% | -0.30 |

### 实际应用示例

#### 案例1：半导体ETF（高波动）

```python
配置：
  - 风险阈值: 4分
  - 最大仓位: 80%
  - 回撤容忍: 25%

行为：
  1. 风险3分时 → 继续持仓（因为阈值是4）
  2. 风险4分时 → 限制买入
  3. 回撤20%时 → 轻微惩罚（因为容忍25%）
  4. 回撤26%时 → 重罚并止损

预期：
  - 更能抓住上涨机会
  - 容忍正常波动
  - 高收益 + 可控风险
```

#### 案例2：招商银行（低波动）

```python
配置：
  - 风险阈值: 2分
  - 最大仓位: 100%
  - 回撤容忍: 15%

行为：
  1. 风险2分时 → 限制买入（更谨慎）
  2. 风险3分时 → 强制空仓
  3. 回撤10%时 → 中度惩罚
  4. 回撤16%时 → 重罚并止损

预期：
  - 稳健增长
  - 严格风控
  - 低波动 + 稳定收益
```

---

## 📈 预期效果

### 相比V5的改进

| 指标 | V5（单策略） | V6（差异化策略） |
|------|-------------|-----------------|
| **平均收益** | 28.83% | **30-35%**（预期）|
| **科技股收益** | 30-40% | **35-50%**（更激进）|
| **金融股收益** | 10-15% | **10-15%**（稳健）|
| **最大回撤** | 10.06% | **8-12%**（按类别）|
| **适应性** | 中 | **高**（自适应）|

### 分类预期表现

```
科技板块（高波动）:
  预期收益: 35-50%
  预期回撤: 15-25%
  夏普比率: 1.5-2.0

金融板块（低波动）:
  预期收益: 10-15%
  预期回撤: 5-10%
  夏普比率: 1.2-1.5

消费/医药（中波动）:
  预期收益: 15-25%
  预期回撤: 10-15%
  夏普比率: 1.3-1.8
```

---

## 🎯 组合策略建议

### 策略1：激进组合

```python
资金分配：
  70% → 科技ETF（追求高收益）
  20% → 周期股（波段机会）
  10% → 现金储备

预期：
  年化收益: 40-60%
  最大回撤: 20-30%
  风险等级: 高
```

### 策略2：稳健组合

```python
资金分配：
  40% → 金融股（稳定收益）
  30% → 消费ETF（平衡）
  20% → 宽基ETF（跟踪大盘）
  10% → 现金储备

预期：
  年化收益: 15-25%
  最大回撤: 8-12%
  风险等级: 低
```

### 策略3：平衡组合（推荐）

```python
资金分配：
  50% → 科技ETF（进攻）
  30% → 金融股（防守）
  15% → 消费/医药（平衡）
  5% → 现金储备

预期：
  年化收益: 25-35%
  最大回撤: 12-18%
  风险等级: 中
  夏普比率: 1.5-2.0
```

---

## ⚙️ 高级配置

### 调整风险参数

编辑 `stock_env_v6.py` 中的 `_set_risk_params()`:

```python
# 更激进的科技股策略
if volatility == '高':
    self.risk_threshold = 5  # 从4改为5
    self.max_position = 0.9  # 从0.8改为0.9
    self.drawdown_tolerance = 0.30  # 从0.25改为0.30

# 更保守的金融股策略
elif volatility == '低':
    self.risk_threshold = 1  # 从2改为1
    self.max_position = 0.8  # 从1.0改为0.8
```

### 自定义分类

修改 `metadata_v6.csv`:

```csv
code,name,category,volatility,style
sh.513180,恒生科技,科技,高,激进
sh.600036,招商银行,金融,低,稳健
...
```

---

## 🔬 与前版本对比

| 特性 | V4 Fixed | V5 | V6 |
|------|----------|----|----|
| **标的数量** | 8 | 8 | **17** ⭐ |
| **策略类型** | 单一 | 单一 | **差异化** ⭐ |
| **风险阈值** | 固定3 | 固定3 | **自适应2-4** ⭐ |
| **最大仓位** | 固定 | 固定 | **动态80-100%** ⭐ |
| **分类管理** | ❌ | ❌ | **✅** ⭐ |
| **组合视角** | ❌ | ❌ | **✅** ⭐ |

---

## 📊 实战案例

### 案例1：2024年科技股行情

```
市场情况：科技股大幅波动
策略表现：
  - V5（固定策略）：+30%，回撤18%
  - V6（差异化）：+45%，回撤22%

原因：
  - V6容忍更高波动（阈值4 vs 3）
  - V6最大仓位80%仍能参与
  - 抓住更多上涨机会
```

### 案例2：2024年金融股行情

```
市场情况：金融股平稳上涨
策略表现：
  - V5（固定策略）：+12%，回撤6%
  - V6（差异化）：+11%，回撤4%

原因：
  - V6更谨慎（阈值2 vs 3）
  - 更严格风控
  - 收益略低但更稳健
```

---

## ⚠️ 注意事项

### 1. 数据质量

部分新增ETF上市时间较短（如AI创新2023年），历史数据少，可能影响训练效果。

**建议**：
- 优先使用上市3年以上的标的
- 新标的权重降低

### 2. 过拟合风险

17只标的虽然比8只多，但仍需警惕过拟合。

**建议**：
- 延长训练步数（250万 → 300万）
- 增加更多标的（目标30-50只）
- 使用交叉验证

### 3. 实盘调整

不同标的的交易成本可能不同（港股vs A股）。

**建议**：
- 实盘前单独测试每只标的
- 调整手续费参数
- 考虑汇率影响（港股）

---

## 🚀 快速开始

```bash
# 1. 下载数据（5-10分钟）
python get_stock_data_v6.py

# 2. 训练模型（3-4小时）
python train_v6.py

# 3. 查看结果
# 训练完成后自动显示分类统计

# 4. 查看训练曲线
tensorboard --logdir=./logs_v6/
```

---

## 📚 进阶方向

### 短期

1. **优化分类**：细化行业分类（半导体vs软件）
2. **动态仓位**：根据市场环境动态调整
3. **相关性管理**：避免持仓过度集中

### 中期

1. **多标的组合**：同时管理多只标的
2. **行业轮动**：自动切换强势行业
3. **风格轮动**：牛市激进，熊市保守

### 长期

1. **宏观因子**：整合宏观经济数据
2. **情绪指标**：市场情绪和资金流向
3. **AI预测**：结合价格预测模型

---

## 🎯 总结

**V6 的核心价值**：

```
不再"一视同仁"地对待所有标的
而是"因材施教"，差异化管理

科技股：激进策略，追求高收益
金融股：稳健策略，控制风险
组合起来：攻守兼备，进退自如
```

**适合场景**：
- ✅ 需要管理多只不同类型标的
- ✅ 追求组合收益最大化
- ✅ 希望针对不同标的定制策略

**立即开始**：

```bash
python get_stock_data_v6.py
python train_v6.py
```

**预计训练时间**：3-4小时（250万步）

**祝训练顺利，组合收益最大化！** 🚀📈💰



