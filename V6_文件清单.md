# V6 版本文件清单

## 📁 新增文件（V6专属）

### 1. 核心代码

| 文件名 | 说明 | 重要性 |
|--------|------|--------|
| `get_stock_data_v6.py` | 下载17只标的数据 | ⭐⭐⭐⭐⭐ |
| `stock_env_v6.py` | V6交易环境（差异化策略） | ⭐⭐⭐⭐⭐ |
| `train_v6.py` | V6训练脚本（分类管理） | ⭐⭐⭐⭐⭐ |
| `test_v6.py` | V6环境测试脚本 | ⭐⭐⭐⭐ |

### 2. 文档

| 文件名 | 说明 | 重要性 |
|--------|------|--------|
| `README_V6.md` | V6完整使用文档 | ⭐⭐⭐⭐⭐ |
| `版本演进总览_V3_to_V6.md` | 所有版本对比 | ⭐⭐⭐⭐⭐ |
| `V6_文件清单.md` | 本文件 | ⭐⭐⭐ |

### 3. 数据文件（训练后生成）

| 文件/目录 | 说明 | 何时生成 |
|---------|------|---------|
| `stockdata/metadata_v6.csv` | 标的元数据 | 运行`get_stock_data_v6.py`后 |
| `stockdata/train/*.csv` | 训练数据（17只） | 同上 |
| `stockdata/test/*.csv` | 测试数据（17只） | 同上 |
| `ppo_stock_v6.zip` | 训练好的模型 | 运行`train_v6.py`后 |
| `logs_v6/` | 训练日志 | 同上 |
| `models_v6/` | 模型检查点 | 同上 |

---

## 📊 V6新增标的列表

### 原有标的（8只）

| 代码 | 名称 | 类别 | 波动性 |
|------|------|------|--------|
| sh.600000 | 浦发银行 | 金融 | 低 |
| sh.600036 | 招商银行 | 金融 | 低 |
| sz.002083 | 孚日股份 | 周期 | 高 |
| sz.001389 | 广合科技 | 科技 | 高 |
| sh.600418 | 江淮汽车 | 周期 | 中 |
| sz.159966 | 创蓝筹 | 宽基 | 中 |
| sz.159876 | 有色基金 | 周期 | 高 |
| sz.159928 | 消费ETF | 消费 | 中 |

### V6新增（9只）

| 代码 | 名称 | 类别 | 波动性 |
|------|------|------|--------|
| sh.513180 | 恒生科技 | 科技 | 高 |
| sh.512480 | 半导体ETF | 科技 | 高 |
| sh.513090 | 港股非银 | 金融 | 中 |
| sz.159992 | 创新药 | 医药 | 高 |
| sz.159770 | 机器人 | 科技 | 高 |
| sh.588000 | 科创50 | 科技 | 高 |
| sh.515070 | AI创新 | 科技 | 高 |
| sh.588030 | 科创智能 | 科技 | 高 |
| sh.516160 | 新能源 | 新能源 | 高 |

**总计：17只标的**

---

## 🔄 与其他版本的关系

### 依赖关系

```
V6 独立运行
  ├─ 不依赖 V5/V4/V3 的模型
  ├─ 但继承了 V5 的风险感知机制
  └─ 可以单独使用
```

### 兼容性

```
模型不兼容：
  - V6模型 ≠ V5模型（观测空间不同）
  - V6环境 ≠ V5环境（新增标的类别信息）

数据不兼容：
  - V6需要17只标的数据
  - V5只需要8只标的数据
  - 需要单独运行 get_stock_data_v6.py
```

---

## 📋 使用流程

### 完整流程

```bash
# 1. 下载V6数据（必须）
python get_stock_data_v6.py
# 生成：stockdata/train/*.csv（17只）
#      stockdata/test/*.csv（17只）
#      stockdata/metadata_v6.csv

# 2. 测试环境（可选但推荐）
python test_v6.py
# 验证：环境创建、动作执行、差异化策略

# 3. 训练模型（核心）
python train_v6.py
# 生成：ppo_stock_v6.zip
#      logs_v6/
#      models_v6/
# 输出：分类统计、最佳/最差标的

# 4. 查看训练曲线（可选）
tensorboard --logdir=./logs_v6/
```

### 最小流程

```bash
# 1. 下载数据
python get_stock_data_v6.py

# 2. 训练
python train_v6.py
```

---

## 🔍 关键文件详解

### 1. `get_stock_data_v6.py`

**功能**：
- 下载17只标的的历史数据
- 生成元数据文件（包含分类信息）
- 自动分割训练集和测试集

**运行时间**：5-10分钟

**输出**：
```
stockdata/
  ├─ train/
  │   ├─ sh.600000.浦发银行.csv
  │   ├─ sh.513180.恒生科技.csv
  │   └─ ... (共17个)
  ├─ test/
  │   └─ ... (共17个)
  └─ metadata_v6.csv  # 元数据
```

---

### 2. `stock_env_v6.py`

**核心创新**：

```python
# 1. 标的识别
def _identify_stock_type(self, data_file):
    # 从元数据中读取标的分类

# 2. 差异化策略
def _set_risk_params(self):
    if volatility == '高':
        self.risk_threshold = 4
        self.max_position = 0.8
    elif volatility == '低':
        self.risk_threshold = 2
        self.max_position = 1.0

# 3. 差异化奖励
def _calculate_reward_v6(self, ...):
    # 根据标的类别动态调整奖励
```

**观测空间**：126维
- 历史窗口（5天 × 24维） = 120维
- 持仓信息 = 5维
- 标的类别编码 = 1维

**动作空间**：7个离散动作
- 0: 持有
- 1: 买入25%
- 2: 买入50%
- 3: 买入100%
- 4: 卖出25%
- 5: 卖出50%
- 6: 卖出100%

---

### 3. `train_v6.py`

**特点**：
- 自动扫描所有训练数据
- 随机选择标的创建环境
- 分类统计和回测

**训练参数**：
```python
total_timesteps = 2,500,000  # 250万步
n_steps = 2048
batch_size = 256
learning_rate = 3e-4
ent_coef = 0.02  # 鼓励探索
```

**输出示例**：
```
[整体统计]
  平均收益率: +XX%
  平均最大回撤: XX%
  ...

[分类统计]
  [科技] (7只)
    平均收益率: +XX%
    ...
  [金融] (3只)
    ...

[最佳] XXX
[最差] XXX
```

---

### 4. `test_v6.py`

**测试内容**：
1. ✅ 环境创建
2. ✅ 环境重置
3. ✅ 执行动作
4. ✅ 随机交易
5. ✅ 多标的测试
6. ✅ 差异化策略验证

**运行时间**：< 1分钟

**何时运行**：
- 下载数据后
- 修改环境代码后
- 训练前验证

---

## 📝 重要配置文件

### `metadata_v6.csv`

**格式**：
```csv
code,name,category,volatility,style,start_date
sh.513180,恒生科技,科技,高,激进,2020-12-16
sh.600036,招商银行,金融,低,稳健,2002-04-09
...
```

**用途**：
- 环境自动识别标的类别
- 自动应用差异化策略
- 分类统计

**修改方法**：
1. 编辑此CSV文件
2. 调整 `volatility`（高/中/低）
3. 调整 `category`（科技/金融等）
4. 重新运行训练

---

## 🎯 快速开始检查清单

### 准备阶段

- [ ] Python环境已安装（3.8+）
- [ ] 依赖已安装
  ```bash
  pip install stable-baselines3 gymnasium pandas numpy baostock
  ```
- [ ] 磁盘空间足够（至少1GB）

### 数据阶段

- [ ] 运行 `python get_stock_data_v6.py`
- [ ] 确认生成 `stockdata/train/*.csv`（17个文件）
- [ ] 确认生成 `stockdata/test/*.csv`（17个文件）
- [ ] 确认生成 `stockdata/metadata_v6.csv`

### 测试阶段（可选）

- [ ] 运行 `python test_v6.py`
- [ ] 所有测试通过

### 训练阶段

- [ ] 运行 `python train_v6.py`
- [ ] 等待训练完成（3-4小时）
- [ ] 确认生成 `ppo_stock_v6.zip`

---

## 📊 预期文件大小

| 文件/目录 | 大小（估计） |
|---------|------------|
| `stockdata/train/` | 10-20MB |
| `stockdata/test/` | 2-5MB |
| `ppo_stock_v6.zip` | 5-10MB |
| `logs_v6/` | 100-500MB |
| `models_v6/` | 50-200MB |

---

## ⚠️ 常见问题

### Q1: 数据下载失败怎么办？

**A**: 
```bash
# 检查网络连接
# 重新运行
python get_stock_data_v6.py

# 如果某些标的失败，可以注释掉，使用其他标的
```

### Q2: 训练时间太长？

**A**:
```python
# 在 train_v6.py 中减少步数
model.learn(total_timesteps=1_000_000)  # 从250万改为100万
```

### Q3: 内存不够？

**A**:
```python
# 在 train_v6.py 中减少并行环境
train_env = DummyVecEnv([make_env for _ in range(8)])  # 从16改为8
```

### Q4: 某些标的没有数据？

**A**:
- 部分新ETF上市时间短，历史数据少
- 可以在 `get_stock_data_v6.py` 中调整 `start_date`
- 或者移除该标的

---

## 🚀 下一步

### 完成V6后可以：

1. **分析结果**
   ```bash
   tensorboard --logdir=./logs_v6/
   ```

2. **实盘准备**
   - 模拟盘测试1-3个月
   - 小资金实盘

3. **继续优化**
   - 增加更多标的（目标30-50只）
   - 细化行业分类
   - 优化奖励函数

4. **研究方向**
   - 多智能体系统
   - 组合优化算法
   - 实时交易系统

---

## 📚 相关文档

| 文档 | 用途 |
|------|------|
| `README_V6.md` | V6完整文档 |
| `版本演进总览_V3_to_V6.md` | 版本对比 |
| `README_V5.md` | 理解风险感知机制 |
| `问题诊断和修复方案.md` | 理解V4问题 |

---

## 🎉 总结

**V6版本文件清单**：
- ✅ 4个核心代码文件
- ✅ 3个文档文件
- ✅ 17只标的数据（训练+测试）
- ✅ 1个元数据文件

**立即开始**：
```bash
python get_stock_data_v6.py
python test_v6.py
python train_v6.py
```

**预计时间**：
- 数据下载：5-10分钟
- 环境测试：< 1分钟
- 模型训练：3-4小时

**祝你使用顺利！** 🚀📈💰



